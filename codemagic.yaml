# Este es el archivo de configuración de Codemagic YAML para aplicaciones Flutter.
# Puedes encontrar más información en la documentación oficial:
# https://docs.codemagic.io/getting-started/codemagic-yaml/

# 1. Define tu flujo de trabajo
workflows:
  android-build:
    name: Build Android App
    # 2. Configura los disparadores de compilación (cuando se ejecuta el flujo)
    triggering:
      events:
        - push
      branch_patterns:
        - pattern: '*'
          include: true

    # 3. Define la máquina de compilación
    instance_type: mac_mini_m1
    
    # 4. Define los scripts de compilación
    environment:
      flutter: stable
      # Define la ruta de tu proyecto usando la variable de entorno CM_BUILD_DIR
      # Reemplaza 'nombre_de_tu_carpeta' con el nombre de tu proyecto real.
      vars:
        FLUTTER_PROJECT_PATH: "$CM_BUILD_DIR/shoijet"

    scripts:
      - name: Compilar la aplicación
        script: |
          # Navega a la ruta del proyecto de forma segura.
          cd $FLUTTER_PROJECT_PATH
          
          # Instala las dependencias.
          flutter packages get
          
          # Compila la aplicación Android.
          flutter build apk --release

    # 5. Define dónde guardar los artefactos (el archivo .apk)
    artifacts:
      # Asegúrate de que este path sea correcto usando la variable de ruta.
      - $FLUTTER_PROJECT_PATH/build/app/outputs/flutter-apk/app-release.apk

# La sección 'publishing' fue eliminada para evitar errores
# ya que no es necesaria para una compilación básica.
